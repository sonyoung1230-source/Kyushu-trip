<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="referrer" content="no-referrer">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>å®¶æ—è›‹ç”Ÿ2026æ–°æ˜¥æ—…éŠ</title>
    
    <link rel="icon" type="image/png" href="icon.png">
    <link rel="apple-touch-icon" href="icon.png">
    
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* ========== å…¨å±€è¨­å®š ========== */
        :root {
            --gold: #e0c097;
            --dark-blue: #1e2a38;
            --text-main: #ffffff;
            --text-sub: #b0b8c1;
            --tag-bg: rgba(224, 192, 151, 0.2);
            --tip-bg: rgba(243, 156, 18, 0.15);
            --tip-border: #f39c12;
            --modal-bg: #222;
            --input-bg: rgba(255,255,255,0.1);
            --danger-color: #e74c3c;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: 'Noto Sans TC', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #111;
            color: var(--text-main);
            height: 100vh;
            display: flex;
            overflow: hidden;
        }

        /* å·¦å´å°è¦½åˆ— */
        .sidebar {
            width: 90px;
            background: #161b22;
            border-right: 1px solid rgba(255,255,255,0.1);
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            z-index: 10;
            flex-shrink: 0;
            padding-bottom: 20px;
        }

        .sidebar-header {
            padding: 20px 0;
            text-align: center;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        .sidebar-header h1 { font-size: 0.85rem; color: var(--gold); margin: 0; letter-spacing: 1px; line-height: 1.4; }

        .countdown-box {
            font-size: 0.7rem;
            color: #aaa;
            text-align: center;
            margin-top: 8px;
            background: rgba(255,255,255,0.05);
            padding: 4px 0;
            border-radius: 4px;
            margin: 10px 5px;
        }
        .cnt-num { color: var(--gold); font-weight: bold; font-size: 0.9rem; }

        .nav-btn {
            padding: 20px 5px;
            background: transparent;
            border: none;
            color: var(--text-sub);
            cursor: pointer;
            transition: 0.3s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            border-left: 3px solid transparent;
            width: 100%;
        }

        .nav-btn i { font-size: 1.2rem; }
        .nav-btn span { font-size: 0.75rem; font-weight: 500; }
        .nav-btn .date-tag { font-size: 0.6rem; opacity: 0.6; }
        .nav-btn.active { background: rgba(224, 192, 151, 0.1); color: var(--gold); border-left-color: var(--gold); }

        /* å·¥å…·æŒ‰éˆ•å€ */
        .tool-btn-group {
            margin-top: auto;
            border-top: 1px solid rgba(255,255,255,0.1);
            padding-top: 10px;
        }
        #btn-sos.active { background: rgba(231, 76, 60, 0.15); color: #e74c3c; border-left-color: #e74c3c; }

        /* å³å´ä¸»ç•«é¢ */
        .main-content {
            flex: 1;
            position: relative;
            overflow-y: auto; /* é€™æ˜¯æ§åˆ¶æ»¾å‹•çš„åœ°æ–¹ */
            background-color: var(--dark-blue);
            background: linear-gradient(135deg, #1e2a38 0%, #0f141a 100%);
            scroll-behavior: smooth; /* å¹³æ»‘æ»¾å‹•æ•ˆæœ */
        }

        .bg-image-layer {
            position: fixed;
            top: 0; left: 90px; right: 0; bottom: 0;
            background-size: cover;
            background-position: center;
            transition: opacity 0.5s ease;
            opacity: 0.6;
            z-index: 0;
        }
        
        .content-overlay {
            position: relative;
            z-index: 1;
            min-height: 100%;
            background: linear-gradient(to right, rgba(15,20,26,0.95) 0%, rgba(15,20,26,0.6) 100%);
            padding: 30px;
            padding-bottom: 100px;
        }

        /* é é¢æ¨£å¼ */
        .page-header { margin-bottom: 25px; animation: slideDown 0.5s ease; }
        .day-badge { background: var(--gold); color: #111; padding: 4px 12px; border-radius: 4px; font-size: 0.8rem; font-weight: 700; }
        .page-title { font-size: 2rem; margin: 10px 0 5px; text-shadow: 0 4px 10px rgba(0,0,0,0.5); }
        .page-desc { color: #ccc; max-width: 600px; line-height: 1.6; font-size: 0.95rem; margin-bottom: 15px;}

        .tags-container { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 15px; }
        .tag { background: var(--tag-bg); color: var(--gold); padding: 4px 10px; border-radius: 20px; font-size: 0.75rem; border: 1px solid rgba(224, 192, 151, 0.3); display: flex; align-items: center; gap: 5px;}
        .tip-box { background: var(--tip-bg); border-left: 4px solid var(--tip-border); padding: 12px; border-radius: 4px; font-size: 0.85rem; color: #ecf0f1; line-height: 1.5; margin-bottom: 25px; max-width: 600px; }
        .tip-title { color: var(--tip-border); font-weight: bold; display: block; margin-bottom: 4px; font-size: 0.8rem; }

        .weather-strip { background: rgba(255,255,255,0.1); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); border-radius: 12px; padding: 15px; margin-bottom: 30px; border: 1px solid rgba(255,255,255,0.1); max-width: 800px; }
        .weather-title { font-size: 0.85rem; color: var(--gold); margin-bottom: 10px; display: flex; justify-content: space-between; }
        .forecast-container { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 5px; }
        .forecast-item { min-width: 70px; text-align: center; background: rgba(0,0,0,0.2); padding: 8px 5px; border-radius: 8px; display: flex; flex-direction: column; align-items: center; }
        .fc-date { font-size: 0.7rem; color: #aaa; }
        .fc-temp { font-size: 0.9rem; font-weight: bold; color: #fff; }

        .timeline { list-style: none; padding: 0; margin: 0; max-width: 600px; animation: fadeIn 0.8s ease; }
        .timeline-item { position: relative; padding-left: 30px; padding-bottom: 30px; border-left: 1px dashed rgba(255,255,255,0.2); }
        .timeline-item:last-child { border: none; }
        .timeline-item::before { content: ''; position: absolute; left: -6px; top: 0; width: 12px; height: 12px; background: var(--gold); border-radius: 50%; box-shadow: 0 0 10px rgba(224, 192, 151, 0.4); }
        .tl-time { color: var(--gold); font-weight: bold; font-size: 0.9rem; display: block; margin-bottom: 5px; }
        .tl-content { display: flex; flex-direction: column; gap: 4px; }
        .tl-act { font-size: 1.05rem; color: #eee; line-height: 1.5; }

        .btn-group { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 6px;}
        .action-btn { display: inline-flex; align-items: center; gap: 5px; padding: 6px 12px; border-radius: 20px; font-size: 0.75rem; text-decoration: none; width: fit-content; transition: 0.2s; cursor: pointer; font-weight: 500; }
        
        .map-btn { background: rgba(52, 152, 219, 0.15); color: #5dade2; border: 1px solid rgba(52, 152, 219, 0.3); }
        .map-btn:hover { background: #3498db; color: #fff; border-color: #3498db; }
        
        .link-btn { background: rgba(46, 204, 113, 0.15); color: #58d68d; border: 1px solid rgba(46, 204, 113, 0.3); }
        .link-btn:hover { background: #2ecc71; color: #fff; border-color: #2ecc71; }
        
        .info-btn { background: rgba(230, 126, 34, 0.15); color: #f39c12; border: 1px solid rgba(230, 126, 34, 0.3); }
        .info-btn:hover { background: #e67e22; color: #fff; border-color: #e67e22; }

        .ticket-btn { background: rgba(155, 89, 182, 0.15); color: #af7ac5; border: 1px solid rgba(155, 89, 182, 0.3); }
        .ticket-btn:hover { background: #9b59b6; color: #fff; border-color: #9b59b6; }

        /* ========== è¨˜å¸³æ¨£å¼ ========== */
        .budget-container { max-width: 600px; animation: fadeIn 0.5s ease; }
        .total-card { background: linear-gradient(135deg, #b7950b, #d4af37); padding: 20px; border-radius: 16px; text-align: center; margin-bottom: 20px; box-shadow: 0 5px 15px rgba(212, 175, 55, 0.3); }
        .total-label { font-size: 0.9rem; color: rgba(0,0,0,0.6); font-weight: bold; }
        .total-amount { font-size: 2.2rem; font-weight: 800; color: #fff; margin: 5px 0; }
        .total-unit { font-size: 0.9rem; color: rgba(255,255,255,0.8); background: rgba(0,0,0,0.1); padding: 2px 10px; border-radius: 10px; display: inline-block;}
        .budget-form { background: rgba(255,255,255,0.05); padding: 15px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.1); display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 20px; }
        .budget-row { display: flex; gap: 10px; width: 100%; }
        .budget-input { background: var(--input-bg); border: 1px solid rgba(255,255,255,0.2); color: #fff; padding: 10px; border-radius: 8px; flex: 1; min-width: 0; }
        .budget-select { background: var(--input-bg); border: 1px solid rgba(255,255,255,0.2); color: #fff; padding: 10px; border-radius: 8px; width: 80px; }
        .add-btn { background: var(--gold); color: #000; border: none; padding: 10px 20px; border-radius: 8px; font-weight: bold; cursor: pointer; width: 100%; }
        .expense-list { list-style: none; padding: 0; margin: 0; }
        .expense-item { background: rgba(255,255,255,0.03); border-bottom: 1px solid rgba(255,255,255,0.05); padding: 12px; display: flex; align-items: center; justify-content: space-between; }
        .ex-left { display: flex; align-items: center; gap: 10px; }
        .ex-icon { width: 36px; height: 36px; border-radius: 50%; background: rgba(255,255,255,0.1); display: flex; align-items: center; justify-content: center; font-size: 1rem; color: var(--gold); }
        .ex-info h4 { margin: 0; font-size: 0.95rem; color: #fff; }
        .ex-info span { font-size: 0.75rem; color: #aaa; }
        .ex-right { text-align: right; }
        .ex-price-twd { font-weight: bold; color: #fff; display: block; font-size: 1rem; }
        .ex-price-jpy { font-size: 0.7rem; color: #888; display: block; }
        .del-btn { color: #e74c3c; background: none; border: none; cursor: pointer; padding: 10px; margin-left: 10px; font-size: 1.1rem; }

        /* ç·Šæ€¥æ±‚åŠ© */
        .sos-container { max-width: 600px; animation: fadeIn 0.5s ease; }
        .sos-card { background: rgba(231, 76, 60, 0.1); border: 1px solid rgba(231, 76, 60, 0.3); padding: 20px; border-radius: 12px; margin-bottom: 20px; display: flex; align-items: center; justify-content: space-between; }
        .sos-info h3 { margin: 0; color: #e74c3c; font-size: 1.1rem; }
        .sos-info p { margin: 5px 0 0; color: #ccc; font-size: 0.85rem; }
        .sos-call-btn { background: #e74c3c; color: white; text-decoration: none; padding: 10px 20px; border-radius: 50px; font-weight: bold; display: flex; align-items: center; gap: 5px; box-shadow: 0 4px 10px rgba(231, 76, 60, 0.3); }
        .sos-call-btn:hover { background: #c0392b; }

        /* Modal */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); backdrop-filter: blur(5px); z-index: 2000; display: flex; align-items: center; justify-content: center; opacity: 0; visibility: hidden; transition: 0.3s; padding: 20px; }
        .modal-overlay.show { opacity: 1; visibility: visible; }
        .modal-card { background: var(--modal-bg); width: 100%; max-width: 500px; border-radius: 16px; border: 1px solid rgba(255,255,255,0.15); overflow: hidden; box-shadow: 0 10px 40px rgba(0,0,0,0.6); transform: scale(0.9); transition: 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); max-height: 90vh; display: flex; flex-direction: column; }
        .modal-overlay.show .modal-card { transform: scale(1); }
        .modal-img-container { height: 220px; overflow: hidden; position: relative; flex-shrink: 0; background: #000; }
        .modal-img { width: 100%; height: 100%; object-fit: cover; transition: opacity 0.3s; }
        .modal-close { position: absolute; top: 15px; right: 15px; background: rgba(0,0,0,0.5); color: #fff; width: 36px; height: 36px; border-radius: 50%; display: flex; align-items: center; justify-content: center; border: 1px solid rgba(255,255,255,0.3); cursor: pointer; font-size: 1.2rem; z-index: 10; backdrop-filter: blur(4px); }
        .modal-content { padding: 25px; overflow-y: auto; }
        .modal-title { font-size: 1.4rem; color: var(--gold); margin: 0 0 15px 0; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 10px; line-height: 1.4; }
        .modal-desc { font-size: 1rem; color: #ddd; line-height: 1.8; text-align: justify; white-space: pre-wrap; }

        /* è¼ªæ’­æŒ‰éˆ• */
        .slider-nav {
            position: absolute; top: 50%; width: 100%; display: flex; justify-content: space-between; padding: 0 10px; transform: translateY(-50%); pointer-events: none;
        }
        .slider-btn {
            background: rgba(0,0,0,0.5); color: #fff; border: none; padding: 10px; cursor: pointer; border-radius: 50%; pointer-events: auto; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center;
        }
        .slider-counter {
            position: absolute; top: 15px; left: 15px; background: rgba(0,0,0,0.6); color: #fff; padding: 2px 8px; border-radius: 10px; font-size: 0.8rem; z-index: 5;
        }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slideDown { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }

        @media (min-width: 768px) {
            .sidebar { width: 200px; }
            .bg-image-layer { left: 200px; }
            .nav-btn { flex-direction: row; padding-left: 30px; text-align: left; }
            .nav-btn i { margin-right: 10px; width: 20px; text-align: center;}
            .content-overlay { padding-left: 50px; }
        }
    </style>
</head>
<body>
    <nav class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h1>å®¶æ—è›‹ç”Ÿ2026<br>æ–°æ˜¥æ—…éŠ</h1>
            <div class="countdown-box" id="countdown">
                è·é›¢å‡ºç™¼<br><span class="cnt-num" id="days-left">0</span> å¤©
            </div>
        </div>
        
        <div class="tool-btn-group">
            <button class="nav-btn" id="btn-budget" onclick="loadBudget()">
                <i class="fas fa-wallet"></i>
                <span>è¨˜å¸³åŠ©æ‰‹</span>
                <span class="date-tag">Expense</span>
            </button>
            <button class="nav-btn" id="btn-sos" onclick="loadEmergency()">
                <i class="fas fa-first-aid"></i>
                <span>ç·Šæ€¥æ±‚åŠ©</span>
                <span class="date-tag">SOS</span>
            </button>
        </div>
    </nav>

    <main class="main-content">
        <div id="bg-layer" class="bg-image-layer"></div>
        <div class="content-overlay" id="main-container"></div>
    </main>

    <!-- å½ˆå‡ºè¦–çª— -->
    <div class="modal-overlay" id="modal">
        <div class="modal-card">
            <div class="modal-img-container" id="modal-img-container">
                <button class="modal-close" onclick="closeModal()">&times;</button>
                <div class="slider-counter" id="slider-counter" style="display:none;">1/1</div>
                <img src="" id="modal-img" class="modal-img">
                <div class="slider-nav" id="slider-nav" style="display:none;">
                    <button class="slider-btn" onclick="changeSlide(-1)">&#10094;</button>
                    <button class="slider-btn" onclick="changeSlide(1)">&#10095;</button>
                </div>
            </div>
            <div class="modal-content">
                <h3 class="modal-title" id="modal-title"></h3>
                <div class="modal-desc" id="modal-desc"></div>
            </div>
        </div>
    </div>

    <script>
        const apiKey = '8e5674ecc7d8d72c4090fd64fcd2be3d'; 
        const EXCHANGE_RATE = 0.20; 

        // æ†‘è­‰è¼ªæ’­è®Šæ•¸
        let currentVoucherImgs = [];
        let currentSlideIdx = 0;

        const tripData = [
            {
                day: "Day 1", date: "2/20 (äº”)", title: "ç¦å²¡ãƒ»å±‹å°ä¹‹å¤œ",
                desc: "æŠµé”ç¦å²¡ï¼Œæ„Ÿå—ä¹å·é–€æˆ¶çš„ç¹è¯ã€‚å¤œæ™šä¸€å®šè¦å»ä¸­æ´²å±‹å°ï¼Œé«”é©—åœ¨æ²³ç•”å°æ”¤åƒæ‹‰éºµçš„ç¨ç‰¹æ°›åœã€‚",
                tags: ["å¿…åƒï¼šè±šéª¨æ‹‰éºµ", "å¿…åƒï¼šæ˜å¤ªå­", "å¿…åƒï¼šé—œæ±ç…®"],
                tip: "ç¦å²¡å±‹å°å¤§å¤šã€Œåªæ”¶ç¾é‡‘ã€ï¼Œè«‹æº–å‚™å¥½é›¶éŒ¢ã€‚æ©Ÿå ´æ­åœ°éµåˆ°åšå¤šç«™åªè¦ 5 åˆ†é˜ï¼Œéå¸¸æ–¹ä¾¿ï¼",
                imgBase: "1", icon: "fa-plane", city: "Fukuoka", cityName: "ç¦å²¡ Fukuoka",
                timeline: [
                    { 
                        time: "15:25", act: "é«˜é›„èµ·é£› (è™èˆª IT270)", 
                        map: "é«˜é›„å°æ¸¯æ©Ÿå ´", link: "https://www.tigerairtw.com/zh-tw",
                        booking: "<strong>ğŸ›« å»ç¨‹èˆªç­ (IT270)</strong><br>æ™‚é–“ï¼š15:25 KHH -> 18:55 FUK<br>èˆªç©ºå…¬å¸ï¼šå°ç£è™èˆª" 
                    },
                    { time: "18:55", act: "æŠµé”ç¦å²¡æ©Ÿå ´", map: "ç¦å²¡æ©Ÿå ´", link: "https://www.fukuoka-airport.jp/tw/" },
                    { 
                        time: "20:30", act: "æ°‘å®¿ Check-in (Yamasanæ—)", 
                        map: "Yamasan Fukuoka", 
                        link: ""
                        // booking removed
                    }, 
                    { 
                        time: "21:00", act: "ä¸­æ´²å±‹å°ç¾é£Ÿé«”é©—", map: "ä¸­æ´²å±‹å°", 
                        link: "", 
                        info: "ç¦å²¡çš„å±‹å°ï¼ˆè·¯é‚Šæ”¤ï¼‰æ˜¯æ—¥æœ¬æ¥µå°‘æ•¸ä¿ç•™ä¸‹ä¾†çš„é£²é£Ÿæ–‡åŒ–ã€‚ä¸­æ´²å·ç«¯æ²¿è‘—æ²³ç•”æ’åˆ—è‘—æ•¸åå®¶å±‹å°ï¼Œæ°£æ°›æ¥µä½³ã€‚æ¨è–¦å“åšåšå¤šè±šéª¨æ‹‰éºµã€æ˜å¤ªå­ç‰å­ç‡’å’Œç†±é¨°é¨°çš„é—œæ±ç…®ã€‚",
                        infoImg: "info_yatai.jpg" 
                    }
                ]
            },
            {
                day: "Day 2", date: "2/21 (å…­)", title: "é–€å¸æ¸¯ãƒ»å¤•é™½çµ•æ™¯",
                desc: "å‰å¾€åŒ—ä¹å·ï¼Œæ¼«æ­¥åœ¨å……æ»¿å¤§æ­£æµªæ¼«é¢¨æƒ…çš„é–€å¸æ¸¯è»Šç«™ã€‚ä¸‹åˆé€ è¨ªå®®åœ°å¶½ç¥ç¤¾ï¼Œæœè–å…‰ä¹‹é“ã€‚",
                tags: ["å¿…åƒï¼šé–€å¸æ¸¯ç‡’å’–å“©", "å¿…åƒï¼šå”æˆ¶å¸‚å ´æ²³è±š"],
                tip: "å”æˆ¶å¸‚å ´åªæœ‰é€±æœ«(äº”å…­æ—¥)æœ‰ç‡Ÿæ¥­ã€Œæ´»ãã„ãé¦¬é–¢è¡—ã€ã€‚å®®åœ°å¶½ç¥ç¤¾å…‰ä¹‹é“æœ€ä½³è§€è³æ™‚é–“æ˜¯å¤•é™½æ™‚åˆ†ã€‚",
                imgBase: "2", icon: "fa-archway", city: "Kitakyushu", cityName: "åŒ—ä¹å· Kitakyushu",
                timeline: [
                    { 
                        time: "08:03", act: "åšå¤šç«™å‡ºç™¼ â†’ é–€å¸æ¸¯", 
                        map: "åšå¤šç«™", 
                        link: "https://www.kanmon-kisen.co.jp/route/kanmon.html", 
                    },
                    { 
                        time: "09:00", act: "å”æˆ¶å¸‚å ´åƒæµ·é®®", map: "å”æˆ¶å¸‚å ´", 
                        link: "", 
                        info: "å”æˆ¶å¸‚å ´ä½æ–¼ä¸‹é—œï¼Œèˆ‡é–€å¸æ¸¯éš”æµ·ç›¸æœ›ã€‚é€±æœ«æœƒè®Šèº«ç‚ºç†±é¬§çš„æµ·é®®å¸‚é›†ï¼ŒéŠå®¢å¯ä»¥ç›´æ¥è²·æ–°é®®çš„æ²³è±šç”Ÿé­šç‰‡ã€æ¡å£½å¸åœ¨æµ·é‚Šäº«ç”¨ã€‚",
                        infoImg: "info_karato.jpg"
                    },
                    { time: "12:20", act: "åˆé¤ï¼šé–€å¸æ¸¯ç‡’å’–å“©", map: "é–€å¸æ¸¯ ç‡’å’–å“©", link: "" },
                    { 
                        time: "13:20", act: "é—œé–€æµ·å³½åšç‰©é¤¨åƒè¨ªï¼ˆæ¨“ä¸Šå–ä¸‹åˆèŒ¶ï¼‰", 
                        map: "é—œé–€æµ·å³½åšç‰©é¤¨", 
                        link: "" 
                    },
                    { 
                        time: "15:32", act: "å®®åœ°å¶½ç¥ç¤¾ (å…‰ä¹‹é“)", map: "å®®åœ°å¶½ç¥ç¤¾", 
                        link: "https://www.miyajidake.or.jp/",
                        info: "å®®åœ°å¶½ç¥ç¤¾æœ€è‘—åçš„å°±æ˜¯ã€Œå…‰ä¹‹é“ã€ï¼Œæ¯å¹´2æœˆèˆ‡10æœˆï¼Œå¤•é™½æœƒå‰›å¥½è½åœ¨åƒé“ç›¡é ­çš„æµ·é¢ä¸Šï¼Œå½¢æˆä¸€æ¢é‡‘é»ƒè‰²çš„å…‰è¼å¤§é“ã€‚æ­¤å¤–ï¼Œé€™è£¡é‚„æœ‰å…¨æ—¥æœ¬ç¬¬ä¸€å¤§çš„æ³¨é€£ç¹©ã€‚",
                        infoImg: "info_miyaji.jpg"
                    },
                    { 
                        time: "19:00", act: "è¿”å›åšå¤šå¸‚å€ (å®¿: Yamasanæ—)", 
                        map: "Yamasan Fukuoka", 
                        link: "" 
                    }
                ]
            },
            {
                day: "Day 3", date: "2/22 (æ—¥)", title: "ç”±å¸ƒé™¢ãƒ»é»‘å·ç§˜æ¹¯",
                desc: "ç§Ÿè»Šè‡ªé§•ï¼Œäº«å—ç”±å¸ƒé™¢é‡‘é±—æ¹–çš„æ™¨éœ§ï¼Œæ™šä¸Šå…¥ä½æ·±å±±ç§˜å¢ƒé»‘å·æº«æ³‰ã€‚",
                tags: ["å¿…åƒï¼šB-speak è›‹ç³•æ²", "å¿…åƒï¼šé‡‘è³å¯æ¨‚é¤…", "é«”é©—ï¼šå…¥æ¹¯æ‰‹å½¢"],
                tip: "é»‘å·æº«æ³‰ä½æ–¼æ·±å±±ï¼Œå¤œæ™šæ°£æº«è¼ƒä½ã€‚è‹¥è¦æ³¡å¤šå®¶æº«æ³‰ï¼Œå»ºè­°è³¼è²·ã€Œå…¥æ¹¯æ‰‹å½¢ã€ã€‚",
                imgBase: "3", icon: "fa-car", city: "Yufu", cityName: "ç”±å¸ƒé™¢/é»‘å·",
                timeline: [
                    { 
                        time: "09:00", act: "å–è»Šè‡ªé§•å‡ºç™¼", map: "åšå¤šç§Ÿè»Š", link: "",
                        booking: "<strong>ğŸš— ç§Ÿè»Šé ç´„å–® (Tabirai)</strong><br>é ç´„è™Ÿç¢¼ï¼š140753607<br>ç§Ÿè»Šå…¬å¸ï¼šBudgetç§Ÿè»Šå…¬å¸<br>è»Šå‹ï¼šã€ç¦ç…™è»Šã€‘FREEDåŒç­‰ç´š(M)<br>------------------------------<br><strong>ğŸ“ å–è»Š (åšå¤š)</strong><br>æ™‚é–“ï¼š2026/2/22 (æ—¥) 9:00<br>åœ°é»ï¼šAvis , Budget Car Rental ãƒã‚¸ã‚§ãƒƒãƒˆãƒ»ãƒ¬ãƒ³ã‚¿ã‚«ãƒ¼ åšå¤šé§…ç­‘ç´«å£åº—<br>é›»è©±ï¼š092-461-8255<br>åœ°å€ï¼šç¦å²¡ç¸£ç¦å²¡å¸‚åšå¤šå€åšå¤šé§…æ±1ä¸ç›®18-10<br>é ç´„è€…ï¼šLEE CHAO CHUN"
                    },
                    { time: "10:20", act: "ä¹…ç•™ç±³æ¡è‰è“", map: "ä¹…ç•™ç±³ è‰è“åœ’", link: "" },
                    { 
                        time: "11:00", act: "åˆ¥åºœç©ºä¸­çºœè»Š (é›¨å‚™: åˆ¥åºœåœ°ç„æº«æ³‰)", 
                        map: "åˆ¥åºœç©ºä¸­çºœè»Š", 
                        link: "" 
                    },
                    { 
                        time: "12:30", act: "ç”±å¸ƒé™¢æ•£ç­–ã€é‡‘é±—æ¹–", map: "é‡‘é±—æ¹–", 
                        link: "https://www.city.yufu.oita.jp/",
                        info: "ç”±å¸ƒé™¢æ˜¯ä¹å·æœ€å—æ­¡è¿çš„æº«æ³‰å‹åœ°ä¹‹ä¸€ï¼Œè¡—é“å……æ»¿æ­é¢¨èˆ‡æ—¥å¼æ··åˆçš„æ–‡é’æ„Ÿã€‚é‡‘é±—æ¹–åœ¨ç§‹å†¬çš„æ¸…æ™¨æœƒå› ç‚ºæº«æ³‰æ°´æ°£è€Œç”¢ç”Ÿå¤¢å¹»çš„æ™¨éœ§ã€‚",
                        infoImg: "info_yufu.jpg"
                    },
                    { time: "15:00", act: "å‰å¾€é»‘å·æº«æ³‰", map: "Yukyonohibiki Yusai æ¹¯å³¡ã®éŸ¿ã å„ªå½©", link: "https://www.kurokawaonsen.or.jp/" },
                    { 
                        time: "16:30", act: "æº«æ³‰æ—…é¤¨ä¸€æ³ŠäºŒé£Ÿ (å„ªå½©)", 
                        map: "Yukyonohibiki Yusai æ¹¯å³¡ã®éŸ¿ã å„ªå½©",
                        info: "é»‘å·æº«æ³‰ä»¥ã€Œéœ²å¤©é¢¨å‘‚ã€èåå…¨æ—¥æœ¬ã€‚é€™è£¡ä¿æŒäº†å¤è‰²å¤é¦™çš„æ±Ÿæˆ¶é¢¨æƒ…ï¼Œæ²’æœ‰å¤§å‹éœ“è™¹æ‹›ç‰Œã€‚ä½¿ç”¨ã€Œå…¥æ¹¯æ‰‹å½¢ã€å¯ä»¥ä»»é¸ä¸‰é–“æ—…é¤¨çš„éœ²å¤©æº«æ³‰é«”é©—ã€‚",
                        infoImg: "info_kurokawa.jpg"
                        // booking removed
                    }
                ]
            },
            {
                day: "Day 4", date: "2/23 (ä¸€)", title: "é˜¿è˜‡ç«å±±ãƒ»é«˜åƒç©—",
                desc: "è¦‹è­‰é˜¿è˜‡ç«å±±çš„å£¯é—Šï¼Œä¸‹åˆæ·±å…¥ç¥è©±ç™¼æºåœ°é«˜åƒç©—å³½ã€‚",
                tags: ["å¿…å–ï¼šé˜¿è˜‡ç‰›å¥¶", "é«”é©—ï¼šé«˜åƒç©—æ•£ç­–"],
                tip: "é˜¿è˜‡ç«å±±å£æœƒå› ç“¦æ–¯æ¿ƒåº¦ç®¡åˆ¶é—œé–‰ã€‚é«˜åƒç©—å³½æ­¥é“é©åˆæ•£æ­¥æ‹ç…§ï¼Œç©ºæ°£éå¸¸æ¸…æ–°ã€‚",
                imgBase: "4", icon: "fa-mountain", city: "Aso", cityName: "é˜¿è˜‡ Aso",
                timeline: [
                    { 
                        time: "10:00", act: "é›¢é–‹æ°‘å®¿ (Check-out)", map: "Yukyonohibiki Yusai æ¹¯å³¡ã®éŸ¿ã å„ªå½©", 
                        link: "",
                    },
                    { 
                        time: "10:30", act: "å¤§è§€å³°æ™¯è§€æª¯", map: "å¤§è§€å³°", 
                        link: "", 
                        info: "é˜¿è˜‡å±±æ“æœ‰å…¨ä¸–ç•Œæœ€å¤§çš„ç ´ç«å±±å£ä¹‹ä¸€ã€‚åœ¨å¤§è§€å³°å¯ä»¥360åº¦ä¿¯ç°é˜¿è˜‡äº”å²³ï¼ˆåƒä¸€å°Šè‡¥ä½›ï¼‰ä»¥åŠå»£é—Šçš„ç ´ç«å±±å£å¹³åŸï¼Œæ™¯è‰²æ¥µç‚ºå£¯è§€ã€‚",
                        infoImg: "info_aso.jpg"
                    },
                    { time: "11:30", act: "ç«å±±å£åƒè§€", map: "é˜¿è˜‡ä¸­å²³ç«å±±å£", link: "" },
                    { 
                        time: "13:20", act: "æ­ä¹˜é«˜åƒç©—å°ç«è»Š", map: "é«˜åƒç©‚ã‚ã¾ã¦ã‚‰ã™é‰„é“æ ªå¼ä¼šç¤¾", 
                        link: "https://amaterasurailway.jp/",
                        info: "æ­ä¹˜å°ç«è»Šç©¿è¶Šé«˜åƒç©—éµæ©‹ï¼Œå¯ä»¥å¾é«˜ç©ºä¿¯ç°çµ•ç¾çš„å³½è°·æ™¯è‰²ã€‚é€™æ˜¯ç”±å»¢æ£„éµé“æ”¹å»ºè€Œæˆçš„è§€å…‰åˆ—è»Šã€‚",
                        infoImg: "info_takachiho.jpg"
                    },
                    { time: "20:00", act: "è¿”å›æ°‘å®¿ (REQRAS)", map: "REQRASã‚µã‚¯ãƒ©ãƒãƒ", link: "" }
                ]
            },
            {
                day: "Day 5", date: "2/24 (äºŒ)", title: "å±±é¹¿ãƒ»ç†Šæœ¬åŸ",
                desc: "åƒè§€æ­·å²æ‚ ä¹…çš„ç†Šæœ¬åŸï¼Œå¤©å®ˆé–£çš„å£¯éº—ä¸å®¹éŒ¯éã€‚",
                tags: ["å¿…åƒï¼šç”Ÿé¦¬è‚‰åˆºèº«", "å¿…åƒï¼šç†Šæœ¬æ‹‰éºµ", "å¿…è²·ï¼šç†Šæœ¬ç†Šå‘¨é‚Š"],
                tip: "ç†Šæœ¬åŸç¯„åœå¾ˆå¤§ï¼Œä¸”å¤šæ¨“æ¢¯èˆ‡æ–œå¡ï¼Œè«‹ç©¿å¥½èµ°çš„é‹å­ã€‚",
                imgBase: "5", icon: "fa-landmark", city: "Kumamoto", cityName: "ç†Šæœ¬ Kumamoto",
                timeline: [
                    { 
                        time: "10:00", act: "å…«åƒä»£åº§ (æ¬£è³å‚³çµ±è¡¨æ¼”)", map: "å…«åƒä»£åº§", 
                        link: "https://yamaga-tanbou.jp/",
                        info: "å…«åƒä»£åº§æ˜¯å»ºæ–¼1910å¹´çš„èŠå±…å°å±‹ï¼ˆå‚³çµ±åŠ‡å ´ï¼‰ï¼Œè‡³ä»Šä»ä¿ç•™è‘—æ±Ÿæˆ¶æ™‚ä»£çš„é¢¨è²Œã€‚æŠ¬é ­å¯è¦‹å¤©èŠ±æ¿ä¸Šè‰²å½©é®®è±”çš„å»£å‘Šç•«ï¼Œæ˜¯æ‹ç…§çš„ä¸€å¤§äº®é»ã€‚",
                        infoImg: "info_yachiyo.jpg"
                    },
                    { 
                        time: "12:00", act: "å±±é¹¿æº«æ³‰æ–‡åŒ–åœ’å€", map: "å±±é¹¿æº«æ³‰", link: "",
                        info: "æ¼«æ­¥åœ¨å……æ»¿æ­·å²æ„Ÿçš„è±å‰è¡—é“ï¼Œå¯ä»¥åƒè§€ã€Œæ«»æ¹¯ã€ï¼Œé€™æ˜¯ç”±æ±Ÿæˆ¶æ™‚ä»£çš„å¾¡èŒ¶å±‹æ”¹å»ºè€Œæˆçš„æº«æ³‰æµ´å ´ï¼Œæœ¨é€ å»ºç¯‰éå¸¸æ°£æ´¾ï¼Œå±•ç¾äº†å±±é¹¿æº«æ³‰çš„ç¹è¯æ­·å²ã€‚",
                        infoImg: "info_yamaga.jpg"
                    },
                    { 
                        time: "15:30", act: "é æ™ºåŸéºè·¡", map: "é æ™ºåŸ", link: "https://www.kofunkan.pref.kumamoto.jp/",
                        info: "é æ™ºåŸæ˜¯ç´„1300å¹´å‰å¤§å’Œæœå»·ç‚ºäº†é˜²ç¦¦è€Œå»ºé€ çš„å¤ä»£å±±åŸã€‚æ¨™èªŒæ€§çš„å…«è§’å½¢é¼“æ¨“éå¸¸ç‰¹åˆ¥ã€‚é€™è£¡åœ°å‹¢è¼ƒé«˜ï¼Œè¦–é‡æ¥µä½³ï¼Œå¯ä»¥çœºæœ›å‘¨é‚Šçš„å¹³åŸæ™¯è‰²ã€‚",
                        infoImg: "info_kikuchi.jpg"
                    },
                    { 
                        time: "18:00", act: "ç†Šæœ¬å¸‚å€é–’æ™ƒ (é‚„è»Š)", map: "ãƒã‚¸ã‚§ãƒƒãƒˆï½¥ãƒ¬ãƒ³ã‚¿ã‚«ãƒ¼ ç†Šæœ¬é§…å‰åº—", link: "",
                        booking: "<strong>ğŸš— é‚„è»Š (ç†Šæœ¬)</strong><br>æ™‚é–“ï¼š2026/2/24 (äºŒ) 19:00<br>åœ°é»ï¼šBudgetç§Ÿè»Š ç†Šæœ¬ç«™å‰åº—<br>æ—¥æ–‡ï¼šãƒã‚¸ã‚§ãƒƒãƒˆï½¥ãƒ¬ãƒ³ã‚¿ã‚«ãƒ¼ ç†Šæœ¬é§…å‰åº—<br>é›»è©±ï¼š096-312-0543<br>åœ°å€ï¼šç†Šæœ¬ç¸£ç†Šæœ¬å¸‚è¥¿å€æ˜¥æ—¥3ä¸ç›®13-6<br>è«‹è¨˜å¾—åŠ æ»¿æ²¹å†é‚„è»Šï¼"
                    },
                    { time: "20:00", act: "è¿”å›æ°‘å®¿ (REQRAS)", map: "REQRASã‚µã‚¯ãƒ©ãƒãƒ", link: "" }
                ]
            },
            {
                day: "Day 6", date: "2/25 (ä¸‰)", title: "å†è¦‹ä¹å·",
                desc: "å¸¶è‘—æ»¿æ»¿çš„å›æ†¶è¿”å›æº«æš–çš„å®¶ã€‚",
                tags: ["å¿…è²·ï¼šç¦å²¡æ˜å¤ªå­", "å¿…è²·ï¼šç­‘ç´«éº»ç³¬", "å¿…è²·ï¼šç¦ç ‚å±‹èœ‚èœœè›‹ç³•"],
                tip: "ç†Šæœ¬æ©Ÿå ´é›–ç„¶ä¸å¤§ï¼Œä½†åœ‹éš›ç·šèˆªå»ˆä¹Ÿæœ‰å…ç¨…åº—ã€‚è«‹é ç•™ 2 å°æ™‚ä»¥ä¸ŠæŠµé”æ©Ÿå ´è¾¦ç†ç™»æ©Ÿã€‚",
                imgBase: "6", icon: "fa-plane-departure", city: "Kumamoto", cityName: "ç†Šæœ¬ Kumamoto",
                timeline: [
                    { time: "09:00", act: "å‰å¾€ç†Šæœ¬æ©Ÿå ´", map: "é˜¿è˜‡ç†Šæœ¬æ©Ÿå ´", link: "https://www.kumamoto-airport.co.jp/" },
                    { 
                        time: "11:55", act: "è¯èˆª CI199 èµ·é£›", map: "", link: "",
                        booking: "<strong>ğŸ›« å›ç¨‹èˆªç­ (CI199)</strong><br>æ™‚é–“ï¼š11:55 KMJ -> 13:40 KHH<br>èˆªç©ºå…¬å¸ï¼šä¸­è¯èˆªç©º"
                    },
                    { time: "13:40", act: "æŠµé”é«˜é›„", map: "", link: "" }
                ]
            }
        ];

        const sidebar = document.getElementById('sidebar');
        const mainContainer = document.getElementById('main-container');
        const bgLayer = document.getElementById('bg-layer');
        
        // Modal Control
        const modal = document.getElementById('modal');
        const modalImg = document.getElementById('modal-img');
        const modalTitle = document.getElementById('modal-title');
        const modalDesc = document.getElementById('modal-desc');
        const sliderNav = document.getElementById('slider-nav');
        const sliderCounter = document.getElementById('slider-counter');
        const modalImgContainer = document.getElementById('modal-img-container');

        // Budget Data
        let expenses = JSON.parse(localStorage.getItem('tripExpenses')) || [];
        expenses = expenses.map((item, index) => {
            if (!item.id) item.id = Date.now() + index;
            return item;
        });

        function updateCountdown() {
            const tripStartDate = new Date("2026/02/20 00:00:00").getTime();
            const tripEndDate = new Date("2026/02/25 23:59:59").getTime(); 
            const now = new Date().getTime();
            const distance = tripStartDate - now;
            const days = Math.ceil(distance / (1000 * 60 * 60 * 24));
            const box = document.getElementById('countdown');

            if (now < tripStartDate) {
                box.innerHTML = `è·é›¢å‡ºç™¼<br><span class="cnt-num">${days}</span> å¤©`;
            } else if (now >= tripStartDate && now <= tripEndDate) {
                box.innerHTML = `<span style="color:#2ecc71; font-weight:bold; font-size:0.8rem;">æ—…ç¨‹<br>é€²è¡Œä¸­ âœˆï¸</span>`;
            } else {
                box.innerHTML = `<span style="color:#aaa; font-size:0.8rem;">æ—…ç¨‹<br>åœ“æ»¿çµæŸ â¤ï¸</span>`;
            }
        }

        function init() {
            updateCountdown();
            const refNode = document.querySelector('.tool-btn-group');
            tripData.forEach((item, index) => {
                const btn = document.createElement('button');
                btn.className = 'nav-btn';
                btn.id = `btn-${index}`;
                btn.innerHTML = `<i class="fas ${item.icon}"></i><span>${item.day}</span><span class="date-tag">${item.date.split(' ')[0]}</span>`;
                btn.onclick = () => loadDay(index);
                sidebar.insertBefore(btn, refNode);
            });
            loadDay(0);
        }

        // é–‹å•Ÿä»‹ç´¹
        window.openInfo = function(dayIndex, timeIndex) {
            const data = tripData[dayIndex].timeline[timeIndex];
            if(data) {
                modalTitle.innerText = data.act;
                modalDesc.innerText = data.info || "æš«ç„¡ä»‹ç´¹";
                
                // é‡ç½®åœ–ç‰‡å€
                modalImgContainer.style.display = "block";
                sliderNav.style.display = "none";
                sliderCounter.style.display = "none";
                modalImg.src = data.infoImg ? data.infoImg : "https://via.placeholder.com/800x400/333/fff?text=No+Image";
                
                modal.classList.add('show');
            }
        }

        // é–‹å•Ÿæ†‘è­‰ (æ”¯æ´å¤šå¼µåœ–ç‰‡è¼ªæ’­)
        window.openBooking = function(dayIndex, timeIndex) {
            const data = tripData[dayIndex].timeline[timeIndex];
            if(data && data.booking) {
                modalTitle.innerText = "é ç´„ / èˆªç­è³‡è¨Š";
                modalDesc.innerHTML = data.booking;
                
                // æª¢æŸ¥æ˜¯å¦æœ‰æ†‘è­‰åœ–ç‰‡
                if(data.bookingImgs && data.bookingImgs.length > 0) {
                    currentVoucherImgs = data.bookingImgs;
                    currentSlideIdx = 0;
                    modalImgContainer.style.display = "block";
                    updateSlider();
                    // åªæœ‰å¤šå¼µåœ–æ‰é¡¯ç¤ºåˆ‡æ›æŒ‰éˆ•
                    if(currentVoucherImgs.length > 1) {
                        sliderNav.style.display = "flex";
                        sliderCounter.style.display = "block";
                    } else {
                        sliderNav.style.display = "none";
                        sliderCounter.style.display = "none";
                    }
                } else {
                    modalImgContainer.style.display = "none"; // æ²’åœ–ç‰‡å°±éš±è—
                }
                modal.classList.add('show');
            }
        }

        window.changeSlide = function(direction) {
            currentSlideIdx += direction;
            if (currentSlideIdx >= currentVoucherImgs.length) currentSlideIdx = 0;
            if (currentSlideIdx < 0) currentSlideIdx = currentVoucherImgs.length - 1;
            updateSlider();
        }

        function updateSlider() {
            modalImg.style.opacity = 0; // æ·¡å‡ºæ•ˆæœ
            setTimeout(() => {
                modalImg.src = currentVoucherImgs[currentSlideIdx];
                sliderCounter.innerText = `${currentSlideIdx + 1}/${currentVoucherImgs.length}`;
                modalImg.style.opacity = 1; // æ·¡å…¥
            }, 150);
        }

        window.closeModal = function() {
            modal.classList.remove('show');
        }
        modal.addEventListener('click', function(e) { if (e.target === modal) closeModal(); });

        function loadDay(index) {
            const data = tripData[index];
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(`btn-${index}`).classList.add('active');
            
            const imgPath = data.imgBase + ".jpg";
            bgLayer.style.opacity = 0;
            setTimeout(() => {
                bgLayer.style.backgroundImage = `url('${imgPath}')`;
                bgLayer.style.opacity = 0.6;
            }, 200);

            let tagsHtml = data.tags.map(tag => `<span class="tag"><i class="fas fa-thumbs-up"></i> ${tag}</span>`).join('');
            let tipHtml = `<div class="tip-box"><span class="tip-title"><i class="fas fa-lightbulb"></i> å°éŠå°æ’‡æ­¥ï¼š</span>${data.tip}</div>`;
            
            let timelineHtml = '';
            data.timeline.forEach((t, tIndex) => {
                let btns = '<div class="btn-group">';
                if(t.map && t.map !== "") {
                    btns += `<a href="https://www.google.com/maps/search/?api=1&query=${t.map}" target="_blank" class="action-btn map-btn"><i class="fas fa-location-arrow"></i> å°èˆª</a>`;
                }
                if(t.link && t.link !== "") {
                    btns += `<a href="${t.link}" target="_blank" class="action-btn link-btn"><i class="fas fa-external-link-alt"></i> å®˜ç¶²</a>`;
                }
                if(t.info && t.info !== "") {
                    btns += `<button onclick="openInfo(${index}, ${tIndex})" class="action-btn info-btn"><i class="fas fa-book-open"></i> ä»‹ç´¹</button>`;
                }
                if(t.booking) {
                    btns += `<button onclick="openBooking(${index}, ${tIndex})" class="action-btn ticket-btn"><i class="fas fa-ticket-alt"></i> æ†‘è­‰</button>`;
                }
                btns += '</div>';
                
                timelineHtml += `<li class="timeline-item"><span class="tl-time">${t.time}</span><div class="tl-content"><span class="tl-act">${t.act}</span>${btns}</div></li>`;
            });

            mainContainer.innerHTML = `
                <div id="header-area" class="page-header">
                    <span class="day-badge">${data.day} â€¢ ${data.date}</span>
                    <h2 class="page-title">${data.title}</h2>
                    <p class="page-desc">${data.desc}</p>
                </div>
                <div id="info-area"><div class="tags-container">${tagsHtml}</div>${tipHtml}</div>
                <div class="weather-strip">
                    <div class="weather-title"><span id="weather-loc-name"></span><span>æœªä¾† 5 å¤©</span></div>
                    <div class="forecast-container" id="forecast-list"></div>
                </div>
                <ul class="timeline" id="timeline-list">${timelineHtml}</ul>
            `;

            // â˜… è‡ªå‹•æ²å‹•å›é ‚éƒ¨ â˜…
            document.querySelector('.main-content').scrollTop = 0;

            fetchWeather(data.city, data.cityName);
        }

        window.loadEmergency = function() {
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('btn-sos').classList.add('active');
            bgLayer.style.opacity = 0;
            setTimeout(() => {
                bgLayer.style.backgroundImage = `linear-gradient(135deg, #2c0b0e, #521010)`;
                bgLayer.style.opacity = 0.9;
            }, 200);

            mainContainer.innerHTML = `
                <div class="sos-container">
                    <div class="page-header">
                        <h2 class="page-title" style="color:#e74c3c"><i class="fas fa-first-aid"></i> ç·Šæ€¥æ±‚åŠ©</h2>
                        <p class="page-desc">é‡åˆ°ç·Šæ€¥ç‹€æ³è«‹ä¿æŒå†·éœï¼Œé»æ“ŠæŒ‰éˆ•å³å¯ç›´æ¥æ’¥è™Ÿã€‚</p>
                    </div>
                    <div class="sos-card"><div class="sos-info"><h3>è­¦å¯Ÿå±€</h3><p>é‡åˆ°çŠ¯ç½ªã€äº‹æ•…ã€éºå¤±ç‰©å“</p></div><a href="tel:110" class="sos-call-btn"><i class="fas fa-phone-alt"></i> 110</a></div>
                    <div class="sos-card"><div class="sos-info"><h3>æ•‘è­·è»Š / æ¶ˆé˜²éšŠ</h3><p>å—å‚·ã€æ€¥ç—…ã€ç«ç½</p></div><a href="tel:119" class="sos-call-btn"><i class="fas fa-phone-alt"></i> 119</a></div>
                    <div class="sos-card" style="background:rgba(52, 152, 219, 0.1); border-color:#3498db;"><div class="sos-info"><h3 style="color:#3498db">å°ç£é§ç¦å²¡è¾¦äº‹è™•</h3><p>è­·ç…§éºå¤±ã€æ€¥é›£æ•‘åŠ©<br>ç¦å²¡å¸‚åšå¤šå€åšå¤šé§…å‰2-5-55</p></div><a href="tel:+81924736655" class="sos-call-btn" style="background:#3498db;"><i class="fas fa-phone-alt"></i> æ’¥æ‰“</a></div>
                    <div class="tip-box" style="margin-top:20px;"><span class="tip-title">ğŸ’¡ å‚™è¨»ï¼š</span>è‹¥åœ¨æ·±å¤œæˆ–å‡æ—¥é‡åˆ°ç·Šæ€¥ç‹€æ³ï¼Œè«‹æ’¥æ‰“ç¦å²¡è¾¦äº‹è™•ç·Šæ€¥è¯çµ¡æ‰‹æ©Ÿï¼š<br><a href="tel:+819087653410" style="color:#f39c12; font-weight:bold; text-decoration:none;">+81-90-8765-3410</a></div>
                </div>
            `;
            document.querySelector('.main-content').scrollTop = 0;
        }

        window.loadBudget = function() {
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('btn-budget').classList.add('active');
            bgLayer.style.opacity = 0;
            setTimeout(() => {
                bgLayer.style.backgroundImage = `linear-gradient(135deg, #111, #333)`;
                bgLayer.style.opacity = 0.9;
            }, 200);
            renderBudgetUI();
            document.querySelector('.main-content').scrollTop = 0;
        }

        window.calcTWD = function() {
            const jpy = document.getElementById('bg-price').value;
            if(jpy) { document.getElementById('bg-twd').value = Math.round(jpy * EXCHANGE_RATE); } else { document.getElementById('bg-twd').value = ''; }
        }

        window.calcJPY = function() {
            const twd = document.getElementById('bg-twd').value;
            if(twd) { document.getElementById('bg-price').value = Math.round(twd / EXCHANGE_RATE); } else { document.getElementById('bg-price').value = ''; }
        }

        function renderBudgetUI() {
            let totalTWD = expenses.reduce((acc, curr) => acc + parseInt(curr.twd), 0);
            let totalJPY = expenses.reduce((acc, curr) => acc + parseInt(curr.price), 0);
            
            let listHtml = expenses.map((item) => `
                <li class="expense-item">
                    <div class="ex-left">
                        <div class="ex-icon">${getIcon(item.cat)}</div>
                        <div class="ex-info"><h4>${item.name}</h4><span>${item.cat}</span></div>
                    </div>
                    <div class="ex-right">
                        <span class="ex-price-twd">NT$${parseInt(item.twd).toLocaleString()}</span>
                        <span class="ex-price-jpy">Â¥${parseInt(item.price).toLocaleString()}</span>
                    </div>
                    <button class="del-btn" onclick="delExpense(${item.id})"><i class="fas fa-trash"></i></button>
                </li>
            `).join('');

            mainContainer.innerHTML = `
                <div class="budget-container">
                    <div class="page-header"><h2 class="page-title"><i class="fas fa-wallet"></i> è¨˜å¸³åŠ©æ‰‹</h2><p class="page-desc">å³æ™‚åŒ¯ç‡æ›ç®— (1 JPY â‰ˆ ${EXCHANGE_RATE} TWD)</p></div>
                    <div class="total-card"><div class="total-label">ç›®å‰ç¸½èŠ±è²»</div><div class="total-amount">NT$ ${totalTWD.toLocaleString()}</div><div class="total-unit">ç´„ Â¥ ${totalJPY.toLocaleString()}</div></div>
                    <div class="budget-form">
                        <input type="text" id="bg-name" class="budget-input" placeholder="å“é … (å¦‚: æ‹‰éºµ)" style="width:100%; margin-bottom:10px;">
                        <div class="budget-row"><input type="number" id="bg-price" class="budget-input" placeholder="æ—¥å¹£ (JPY)" oninput="calcTWD()"><input type="number" id="bg-twd" class="budget-input" placeholder="å°å¹£ (TWD)" oninput="calcJPY()"></div>
                        <div class="budget-row" style="margin-top:10px;"><select id="bg-cat" class="budget-select" style="flex:1;"><option value="é£Ÿ">ğŸ” é£Ÿç‰©</option><option value="è¡Œ">ğŸšŒ äº¤é€š</option><option value="è³¼">ğŸ›ï¸ è³¼ç‰©</option><option value="ä½">ğŸ¨ ä½å®¿</option><option value="æ¨‚">ğŸ¡ å¨›æ¨‚</option></select><button class="add-btn" onclick="addExpense()" style="flex:1;">æ–°å¢</button></div>
                    </div>
                    <ul class="expense-list">${listHtml}</ul>
                </div>
            `;
        }

        function getIcon(cat) { const map = {'é£Ÿ':'ğŸ”','è¡Œ':'ğŸšŒ','è³¼':'ğŸ›ï¸','ä½':'ğŸ¨','æ¨‚':'ğŸ¡'}; return map[cat] || 'ğŸ’°'; }

        window.addExpense = function() {
            const name = document.getElementById('bg-name').value;
            const price = document.getElementById('bg-price').value; 
            const twd = document.getElementById('bg-twd').value;     
            const cat = document.getElementById('bg-cat').value;
            if(!name || !price || !twd) return alert("è«‹è¼¸å…¥å®Œæ•´è³‡è¨Š");
            expenses.unshift({ id: Date.now(), name, price, twd, cat, date: new Date().toLocaleDateString() });
            localStorage.setItem('tripExpenses', JSON.stringify(expenses));
            renderBudgetUI();
        }

        window.delExpense = function(id) {
            if(confirm("ç¢ºå®šåˆªé™¤æ­¤ç­†ç´€éŒ„ï¼Ÿ")) {
                expenses = expenses.filter(item => item.id !== id);
                localStorage.setItem('tripExpenses', JSON.stringify(expenses));
                renderBudgetUI();
            }
        }

        async function fetchWeather(city, cityName) {
            const elTitle = document.getElementById('weather-loc-name');
            const elList = document.getElementById('forecast-list');
            if(!elTitle || !elList) return;
            elTitle.innerHTML = `<i class="fas fa-map-marker-alt"></i> ${cityName}`;
            elList.innerHTML = `<div style="color:#aaa; font-size:0.8rem; padding:10px;"><i class="fas fa-spinner fa-spin"></i> è®€å–ä¸­...</div>`;
            try {
                const url = `https://api.openweathermap.org/data/2.5/forecast?q=${city}&appid=${apiKey}&units=metric&lang=zh_tw`;
                const res = await fetch(url);
                const data = await res.json();
                if (res.ok) {
                    elList.innerHTML = ''; 
                    const dailyData = data.list.filter((item) => item.dt_txt.includes("12:00:00"));
                    const listToRender = dailyData.length >= 4 ? dailyData : [data.list[0], data.list[8], data.list[16], data.list[24], data.list[32]];
                    listToRender.forEach(item => {
                        const dateObj = new Date(item.dt * 1000);
                        const div = document.createElement('div');
                        div.className = 'forecast-item';
                        div.innerHTML = `<span class="fc-date">${dateObj.getMonth()+1}/${dateObj.getDate()}</span><img src="http://openweathermap.org/img/w/${item.weather[0].icon}.png" style="width:30px"><span class="fc-temp">${Math.round(item.main.temp)}Â°</span>`;
                        elList.appendChild(div);
                    });
                } else { elList.innerHTML = `<div style="color:#faa; font-size:0.8rem;">N/A</div>`; }
            } catch (e) { elList.innerHTML = `<div style="color:#faa; font-size:0.8rem;">Error</div>`; }
        }

        init();
    </script>
</body>
</html>
